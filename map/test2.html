<!DOCTYPE html>
<html>

<head>
	<title>Place Autocomplete</title>
	<!-- <script src="https://polyfill.io/v3/polyfill.min.js?features=default&_v=20230826133917"></script> -->

	<style>
		.map-body {
			position: relative;
		}

		#map {
			height: 500px;
			width: 100%;
		}

		.map__actions {
			padding: 10px;
			position: absolute;
			left: 50%;
			top: 0;
			height: max-content;
			width: max-content;
			transform: translateX(-50%);
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
		}

		#addressInput {
			background-color: #fff;
			margin-left: 12px;
			padding: 0 11px 0 13px;
			text-overflow: ellipsis;
		}

		#addressInput:focus {
			border-color: #4d90fe;
		}

		#addMarkerButton {
			padding: 10px 20px;
			background-color: #007bff;
			color: #fff;
			border: none;
			cursor: pointer;
		}

		#openGoogleMapsButton {
			position: absolute;
			left: 50%;
			transform: translateX(-50%);
			bottom: 10%;
			display: none;
			padding: 10px 20px;
			background-color: #007bff;
			color: #fff;
			border: none;
			cursor: pointer;
			opacity: 0;
			transition: opacity 0.5s ease;
		}
	</style>
</head>

<body>
	<div class=" map">
		<div id="map" class="map__body"> </div>
		<div id="selectedPlace" class="map__actions">
			<div class="map__input">
				<input class="map__place pac-target-input" autocomplete="off" type="text" id="addressInput" placeholder="Geben Sie Ihre Adresse ein">
				<button class="map__button button " id="addMarkerButton">Markierung hinzuf√ºgen</button>
			</div>
			<button id="openGoogleMapsButton" class="map__button">Gehen Sie zu Google Maps</button>
		</div>
	</div>
	<script>
		let directionsRenderer = null;
		let userLocationMarker = null;
		let customMarker = null;
		let geolocationRequested = false;

		function initMap() {
			const baceCoords = {
				lat: 51.444307,
				lng: 6.988343
			};

			const mapStyles = [{
					"elementType": "geometry",
					"stylers": [{
						"color": "#f5f5f5"
					}]
				},
				{
					"elementType": "labels.icon",
					"stylers": [{
						"visibility": "off"
					}]
				},
				{
					"elementType": "labels.text.fill",
					"stylers": [{
						"color": "#009999"
					}]
				},
				{
					"featureType": "administrative.land_parcel",
					"elementType": "labels.text.fill",
					"stylers": [{
						"color": "#bdbdbd"
					}]
				},
				{
					"featureType": "poi",
					"elementType": "geometry",
					"stylers": [{
						"color": "#eeeeee"
					}]
				},
				{
					"featureType": "poi",
					"elementType": "labels.text.fill",
					"stylers": [{
						"color": "#009999"
					}]
				},
				{
					"featureType": "poi.park",
					"elementType": "geometry",
					"stylers": [{
						"color": "#e5e5e5"
					}]
				},
				{
					"featureType": "poi.park",
					"elementType": "labels.text.fill",
					"stylers": [{
						"color": "#009999"
					}]
				},
				{
					"featureType": "road",
					"elementType": "geometry",
					"stylers": [{
						"color": "#ffffff"
					}]
				},
				{
					"featureType": "road.arterial",
					"elementType": "labels.text.fill",
					"stylers": [{
						"color": "#009999"
					}]
				},
				{
					"featureType": "road.highway",
					"elementType": "geometry",
					"stylers": [{
						"color": "#dadada"
					}]
				},
				{
					"featureType": "road.highway",
					"elementType": "labels.text.fill",
					"stylers": [{
						"color": "#009999"
					}]
				},
				{
					"featureType": "road.local",
					"elementType": "labels.text.fill",
					"stylers": [{
						"color": "#009999"
					}]
				},
				{
					"featureType": "transit.line",
					"elementType": "geometry",
					"stylers": [{
						"color": "#e5e5e5"
					}]
				},
				{
					"featureType": "transit.station",
					"elementType": "geometry",
					"stylers": [{
						"color": "#eeeeee"
					}]
				},
				{
					"featureType": "water",
					"elementType": "geometry",
					"stylers": [{
						"color": "#c9c9c9"
					}]
				},
				{
					"featureType": "water",
					"elementType": "labels.text.fill",
					"stylers": [{
						"color": "#009999"
					}]
				}
			];

			const map = new google.maps.Map(document.getElementById("map"), {
				center: baceCoords,
				zoom: 12,
				styles: mapStyles,
			});

			// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä–∞ –¥–ª—è –º—ñ—Å—Ç–∞ –ö–∞—Ç–æ–≤—ñ—Ü–µ
			const bacePlaceMarker = new google.maps.Marker({
				position: baceCoords,
				map: map,
				title: "Alpha Automation GmbH Friedbergstrasse 64 üë∑‚Äç‚ôÇÔ∏è",
				icon: {
					url: "img/logo-mini-fotor-2.png",
					scaledSize: new google.maps.Size(40, 40), // –†–æ–∑–º—ñ—Ä –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä–∞
				},
			});

			function initAutocomplete() {
				const addressInput = document.getElementById("addressInput");
				const autocomplete = new google.maps.places.Autocomplete(addressInput);

				autocomplete.addListener("place_changed", () => {
					const place = autocomplete.getPlace();
					if (!place.geometry) {
						alert("Keine Details f√ºr diesen Ort verf√ºgbar.");
						return;
					}
				});
			}

			// –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—É –Ω–∞ –º–∞—Ä–∫–µ—Ä bacePlaceMarker
			bacePlaceMarker.addListener("click", () => {
				if (!geolocationRequested && "geolocation" in navigator) {
					geolocationRequested = true;
					navigator.geolocation.getCurrentPosition(
						(position) => {
							const userCoords = {
								lat: position.coords.latitude,
								lng: position.coords.longitude,
							};
							userLocationMarker = new google.maps.Marker({
								position: userCoords,
								map: map,
								title: "Ihr Standort üö∂‚Äç‚ôÇÔ∏è",
								icon: {
									url: "img/user-marker.png", // –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —à–ª—è—Ö –¥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
									scaledSize: new google.maps.Size(40, 40),
								},
							});
						},
						(error) => {
							console.error("–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –º—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:", error);
							// –¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –≤—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ –ø–æ–ø–∞–ø –∞–±–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
							document.getElementById("addressInput").style.display = "block";
							document.getElementById("addMarkerButton").style.display = "block";
							alert("Wenn Sie den Standort nicht ermitteln k√∂nnen, geben Sie Ihre Adresse ein, um eine Route zu erstellen");
						}
					);
				} else if (!geolocationRequested) {
					console.log("–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º.");
					// –¢—É—Ç –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ –ø–æ–ø–∞–ø –∞–±–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
					document.getElementById("addressInput").style.display = "block";
					document.getElementById("addMarkerButton").style.display = "block";
					alert("Geolokalisierung wird vom Browser nicht unterst√ºtzt.");
				}
			});

			const infoWindow = new google.maps.InfoWindow();

			// –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—É –Ω–∞ –º–∞—Ä–∫–µ—Ä bacePlaceMarker
			bacePlaceMarker.addListener("click", () => {
				const geocoder = new google.maps.Geocoder();
				geocoder.geocode({
					location: bacePlaceMarker.getPosition()
				}, (results, status) => {
					if (status === "OK" && results[0]) {
						const markerAddress = results[0].formatted_address;
						infoWindow.setContent(markerAddress);
						infoWindow.open(map, bacePlaceMarker);
					}
				});
			});

			document.getElementById("addMarkerButton").addEventListener("click", addCustomMarker);

			function addCustomMarker() {
				const address = document.getElementById("addressInput").value;
				if (address.trim() === "") {
					alert("Geben Sie Ihre Adresse ein.");
					return;
				}

				const geocoder = new google.maps.Geocoder();
				geocoder.geocode({
					address: address
				}, (results, status) => {
					if (status === "OK" && results[0]) {
						if (customMarker) {
							customMarker.setMap(null);
						}

						customMarker = new google.maps.Marker({
							position: results[0].geometry.location,
							map: map,
							title: address,
						});

						map.setCenter(results[0].geometry.location);

						buildRoute();
					} else {
						// –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ –º—ñ—Å—Ü–µ –∑–∞ –≤–≤–µ–¥–µ–Ω–æ—é –∞–¥—Ä–µ—Å–æ—é.
						alert("Ich kann unter der von mir eingegebenen Adresse keinen Platz finden..");
					}
				});
			}



			function buildRoute() {
				if (!customMarker) {
					// –ú–∞—Ä–∫–µ—Ä –Ω–µ –¥–æ–¥–∞–Ω–æ. –ù–µ–º–æ–∂–ª–∏–≤–æ –ø–æ–±—É–¥—É–≤–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç
					alert("Kein Token hinzugef√ºgt. Es ist unm√∂glich, eine Route zu bauen.");
					return;
				}

				if (directionsRenderer) {
					directionsRenderer.setMap(null);
				}

				let directionsService = new google.maps.DirectionsService();
				directionsRenderer = new google.maps.DirectionsRenderer({
					map: map,
					panel: document.getElementById("routeInfo"), // –î–æ–¥–∞—î–º–æ –ø–∞–Ω–µ–ª—å –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
				});

				let request = {
					origin: customMarker.getPosition(),
					destination: baceCoords,
					travelMode: google.maps.TravelMode.DRIVING,
				};

				directionsService.route(request, function(response, status) {
					if (status == google.maps.DirectionsStatus.OK) {
						directionsRenderer.setDirections(response);
						// –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ Google –ö–∞—Ä—Ç–∏
						document.getElementById("openGoogleMapsButton").style.display = "block";
					}
				});
			}

			const openGoogleMapsButton = document.getElementById("openGoogleMapsButton");
			openGoogleMapsButton.addEventListener("click", openGoogleMaps);

			function openGoogleMaps() {
				let destinationCoords = encodeURIComponent(`${baceCoords.lat},${baceCoords.lng}`);
				if (customMarker) {
					const originCoords = encodeURIComponent(`${customMarker.getPosition().lat()},${customMarker.getPosition().lng()}`);
					destinationCoords = encodeURIComponent(`${baceCoords.lat},${baceCoords.lng}`);

					const googleMapsLink = `https://www.google.com/maps/dir/?api=1&origin=${originCoords}&destination=${destinationCoords}&travelmode=driving`;
					window.open(googleMapsLink, "_blank");
				} else {
					// –ú–∞—Ä–∫–µ—Ä –Ω–µ –¥–æ–¥–∞–Ω–æ. –ù–µ–º–æ–∂–ª–∏–≤–æ –≤—ñ–¥–∫—Ä–∏—Ç–∏ –º–∞—Ä—à—Ä—É—Ç —É Google –ö–∞—Ä—Ç–∞—Ö
					alert("Kein Token hinzugef√ºgt. Wegbeschreibungen in Google Maps k√∂nnen nicht ge√∂ffnet werden.");

				}
			}

			initAutocomplete();
		}
	</script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCFD8IC2zBit0K14Ek0Pr4NsRaDBqfg3qw&libraries=places,geometry&callback=initMap&_v=20230825003843" defer></script>
	<!-- src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCFD8IC2zBit0K14Ek0Pr4NsRaDBqfg3qw&callback=initMap&libraries=places&v=weekly" -->
</body>

</html>